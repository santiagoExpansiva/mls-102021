var T=Object.defineProperty;var q=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})};var c=class{async upd(e){return await this.saveUserIndexRecord(e)}async add(e){return await this.saveUserIndexRecord(e)}async del(e){return await this.deleteUserIndexRecord(e)}async list(e){return await this.getAllUserIndexRecord(e)}getTable(){return window.table&&window.table.usersDynamo?window.table.usersDynamo:[]}setTable(e){window.table?window.table.usersDynamo=e:window.table={usersDynamo:e}}async saveUserIndexRecord(e){let r=this.getTable();return new Promise((s,o)=>{if(!e.id)e.id=this.getNextId(r),r.push(e);else{let i=r.findIndex(n=>n.id===e.id);r[i]?r[i]=e:r.push(e)}this.setTable(r),s(e)})}async getAllUserIndexRecord(e){let r=this.getTable(),s=[];return r.forEach(o=>{o.fullText.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>=0&&s.push(o)}),new Promise((o,i)=>{o(s)})}async deleteUserIndexRecord(e){let r=this.getTable(),s=r.findIndex(o=>o.id===e);return r[s]&&r.splice(s,1),this.setTable(r),new Promise((o,i)=>{o(!0)})}getNextId(e){return!e||e.length===0?1:Math.max(...e.map(s=>s.id||0))+1}},f=new c;var m=class{async upd(e){return await this.saveUserRecord(e)}async add(e){return await this.saveUserRecord(e)}async del(e){return await this.deleteUserRecord(e)}async list(){return await this.getAllUserRecord()}getTable(){return window.table&&window.table.users?window.table.users:[]}setTable(e){window.table?window.table.users=e:window.table={users:e}}async saveUserRecord(e){let r=this.getTable();return e.version=Date.now().toString(),new Promise((s,o)=>{if(!e.id)e.id=this.getNextId(r),r.push(e);else{let i=r.findIndex(n=>n.id===e.id);r[i]&&(r[i]=e)}this.setTable(r),s(e)})}async getAllUserRecord(){let e=this.getTable();return new Promise((r,s)=>{r(e)})}async deleteUserRecord(e){let r=this.getTable(),s=r.findIndex(o=>o.id===e);return r[s]&&r.splice(s,1),this.setTable(r),new Promise((o,i)=>{o(!0)})}getNextId(e){return!e||e.length===0?1:Math.max(...e.map(s=>s.id||0))+1}},R=new m;var u=class{async add(e){return await this.saveAuditRecord(e)}async list(){return await this.getAllAuditRecord()}getTable(){return window.table&&window.table.audit?window.table.audit:[]}setTable(e){window.table?window.table.audit=e:window.table={audit:e}}async saveAuditRecord(e){let r=this.getTable();return e.id=this.getNextId(r),new Promise((s,o)=>{r.push(e),this.setTable(r),s(e)})}async getAllAuditRecord(){let e=this.getTable();return new Promise((r,s)=>{r(e)})}getNextId(e){return!e||e.length===0?1:Math.max(...e.map(s=>s.id||0))+1}},U=new u;function x(t){if(!t.inDeveloped)throw new Error("Not implement api production");return{io:{local:{user:R,audit:U},dynamoDb:{user:f}}}}var l={};q(l,{exec:()=>$,teste:()=>E});async function y(t,e){let r=await t.io.local.user.add(e),s=await t.io.dynamoDb.user.add({id:r.id,fullText:`${r.details.name}|${r.details.cpf}`}),o={user:"system",date:new Date().toISOString(),action:"add",origin:"User",description:`User create: ${r.id}`};return t.io.local.audit.add(o),r}async function w(t,e){let r={statusCode:200,ok:!0,data:void 0,error:void 0};try{if(!e)throw new Error("[layer2AddUser]:Into the data");return r.data=await y(t,e),r}catch(s){return r.statusCode=400,r.ok=!1,r.error=s.message,r}}async function b(t,e){let s=(await t.io.local.user.list()).find(a=>a.id===e.id),o=await t.io.local.user.upd(e),i={};if(s){let a=s.details||{},p=e.details||{};for(let d of Object.keys(p))a[d]!==p[d]&&(i[d]=a[d])}let n=s?`Updated user ${e.id}.: ${JSON.stringify(i)}`:`Attempt to update user ${e.id}, but there was no previous record.`,D={user:"system",date:new Date().toISOString(),action:"update",origin:"User",description:n};return t.io.local.audit.add(D),o}async function g(t,e){let r={statusCode:200,ok:!0,data:void 0,error:void 0};try{if(!e)throw new Error("[layer2UpdateUser]:Into the data");return r.data=await b(t,e),r}catch(s){return r.ok=!1,r.statusCode=500,r.error=s.message,r}}async function h(t,e){let r=await t.io.local.user.del(e),s={user:"system",date:new Date().toISOString(),action:"delete",origin:"User",description:r?`User deleted: ${e}`:`Attempt to delete user: ${e}`};return t.io.local.audit.add(s),r}async function I(t,e){let r={statusCode:200,ok:!0,data:void 0,error:void 0};try{if(!e||!e.id)throw new Error("[layer2DeleteUser]:Into in id");return r.data=await h(t,e.id),r}catch(s){return r.statusCode=500,r.ok=!1,r.error=s.message,r}}async function A(t,e){let r=await t.io.dynamoDb.user.list(e),s=await t.io.local.user.list(),o=[];r.forEach(n=>o.push(n.id));let i=s.filter(n=>o.includes(n.id||0));return console.info(i),i}async function B(t,e){let r={statusCode:200,ok:!0,data:void 0,error:void 0};try{if(!e)throw new Error("listUser");return r.data=await A(t,e.filter||""),r}catch(s){return r.ok=!1,r.statusCode=500,r.error=s.message,r}}async function C(t){return await t.io.local.audit.list()}async function P(t,e){let r={statusCode:200,ok:!0,data:void 0,error:void 0};try{return r.data=await C(t),r}catch(s){return r.ok=!1,r.statusCode=500,r.error=s.message,r}}async function v(t,e){if(!e||!e.action)return{statusCode:400,ok:!1,error:"Uninformed action"};let r=e.params||void 0;switch(console.info("executou server: 7"+e.action),e.action){case"addUser":return await w(t,r);case"uppUser":return await g(t,r);case"delUser":return await I(t,r);case"listUser":return await B(t,r);case"listAudit":return await P(t,r);default:return{statusCode:400,ok:!1,error:"Uninformed action"}}}async function $(t){let e=x(t);return v(e,t)}function E(){console.info("a2")}Object.assign(window,l);
